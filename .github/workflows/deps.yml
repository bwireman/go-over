name: Dependency Check

on:
  schedule:
    # run once a day at 9am UTC
    - cron: "0 9 * * *"
  push:
    branches:
      - main
  pull_request:

env:
  otp: "27.0"
  gleam: "1.9.1"
  rebar: "3"

jobs:
  check-deps:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: erlef/setup-beam@v1
        with:
          otp-version: ${{ env.otp }}
          gleam-version: ${{ env.gleam }}
          rebar3-version: ${{ env.rebar }}
      - run: gleam build
      - run: gleam run -m go_over -- --outdated
      # create an issue in the repo if there are
      # outdated or vulnerable dependencies
      - uses: jayqi/failed-build-issue-action@v1
        if: failure()
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
